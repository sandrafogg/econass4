---
title: "Appendix"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE, echo = FALSE}
#Load Packages
library(tidyverse)
library(knitr)
library(stargazer)

#Laod the Data Set
mc_carbon_df <- read_csv("HW4Data.csv")
mc_carbon_df

#Notes About Data
#Current carbon emissions in the sectors are: (A=180, B=200, C=220, and D=300).
#Sectors A, B, and C are in country X. Sector D is in a different country, Y.
#Prices are in $/ton and quantities are in tons.

```

###Create a Function for Marginal Abatement Cost of Sector "A"
```{r, include = FALSE}
#Create Function with Linear Regression
#Plot the Points and Regression Line
paris_plotA <- ggplot(mc_carbon_df, aes(x = mc_carbon_df$Abatement, y = mc_carbon_df$MC_A)) + geom_point() + geom_smooth(method = "lm")
paris_plotA

#Find the Equation of the Line
paris_modelA <- lm(MC_A ~ Abatement, data = mc_carbon_df)
coef(paris_modelA)

# Intercept for Sector "A"
int_a <- -8.6444767

#Slope for Sector "A"
slope_a <- 0.5768419

```
Equation for Sector "A"
$$Marginal~Abatement~Cost(A) = -8.6444767 + 0.5768419(Tons~of~Abatement)$$



###Create a Function for Marginal Abatement Cost of Sector "B"
```{r, include=FALSE}
#Create Function with Linear Regression
#Plot the Points and Regression Line
paris_plotB <- ggplot(mc_carbon_df, aes(x = mc_carbon_df$Abatement, y = mc_carbon_df$MC_B)) + geom_point() + geom_smooth(method = "lm")
paris_plotB

#Find the Equation of the Line
paris_modelB <- lm(MC_B ~ Abatement, data = mc_carbon_df)
coef(paris_modelB)


#Intercept for Sector "B"
int_b <- 9.3176977

#Slope for Sector "B"
slope_b <- 0.1987443 

```

Equation for Sector "B"
$$Marginal~Abatement~Cost(B) = 9.3176977 + 0.1987443(Tons~of~Abatement)$$


###Create a Function for Marginal Abatement Cost of Sector "C"
```{r, include = FALSE}
#Create Function with Linear Regression
#Plot the Points and Regression Line
paris_plotC <- ggplot(mc_carbon_df, aes(x = mc_carbon_df$Abatement, y = mc_carbon_df$MC_C)) + geom_point() + geom_smooth(method = "lm")
paris_plotC

#Find the Equation of the Line
paris_modelC <- lm(MC_C ~ Abatement, data = mc_carbon_df)
coef(paris_modelC)

# Intercept for Sector "C"
int_c <- -11.6550307 

#Slope for Sector "C"
slope_c <- 0.7838266

```
Equation for Sector "C"
$$Marginal~Abatement~Cost(C) = -11.6550307 + 0.7838266(Tons~of~Abatement)$$

###Create a Function for Marginal Abatement Cost of Sector "D"
```{r, include = FALSE}
#Create Function with Linear Regression
#Plot the Points and Regression Line
paris_plotD <- ggplot(mc_carbon_df, aes(x = mc_carbon_df$Abatement, y = mc_carbon_df$MC_D)) + geom_point() + geom_smooth(method = "lm")
paris_plotD

#Find the Equation of the Line
paris_modelD <- lm(MC_D ~ Abatement, data = mc_carbon_df)
coef(paris_modelD)

# Intercept for Sector "D"
int_d <- 9.6875061

#Slope for Sector "D"
slope_d <- 0.2599275

```
Equation for Sector "D"
$$Marginal~Abatement~Cost(D) = 9.6875061 + 0.2599275(Tons~of~Abatement)$$


```{r, echo = FALSE, message = FALSE, include = FALSE}
#Create a "tidy" Data Frame
colnames(mc_carbon_df) <- c("Abatement", "A", "B", "C", "D")

carbon_tidy <- mc_carbon_df %>% 
  gather(Sector, Price, A:D) 
```

###Create a Plot for All of the Sectors
```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Create a Plot of All Sectors

paris_plot_all <- ggplot(carbon_tidy, aes(x = Abatement, y = Price)) + geom_point() + geom_smooth(method = "lm", title = "Marginal Abatement Costs by Sector", color = "red4") + facet_wrap(~Sector) + theme_classic() + ggtitle("Marginal Abatement Costs by Sector")

paris_plot_all
plot(paris_plot_all)

```


####Create a Table of Regression Results
```{r, message = FALSE, echo = FALSE, warning = FALSE}
regression_results <- stargazer(paris_modelA, paris_modelB, paris_modelC, paris_modelD, type="text", title="Table 1: Marginal Abatement Cost Regression Results")

```


###Derive Demand Curves and WTP at Current Levels of Emissions 
```{r, include = FALSE}
#Marginal Abatement Costs at Current Emissions
mccurrent_A <- -8.6444767 + (0.5768419*180)
mccurrent_B <- 9.3176977 + (0.1987443*200)
mccurrent_C <- -11.6550307 + (0.7838266*220)
mccurrent_D <- 9.6875061 + (0.2599275*300)


#WTP for the First Unit 
mccurrent_A #$95.18707
mccurrent_B #$49.06656
mccurrent_C #$160.7868
mccurrent_D #$87.66576


(mccurrent_A-0)/0.5768419
(mccurrent_B-0)/0.1987443
(mccurrent_C-0)/0.7838266
(mccurrent_D-0)/0.2599275



```

Sector C is Willing to Pay the Most for Abatement

```{r, include = FALSE}
#Derive Demand Curve of Sector A

# Use Quantities from 0 to 180 by 5 to Estimate a Demand Curve
vector_demand_A <- seq(0,180,by=5)
# Write function for demand curve for Sector A
demand_A_function <- function(x){(slope_a*(180-x)) + int_a}


# Derive demand curve using the values above
demand_A <- demand_A_function(vector_demand_A)
demand_A

# Graph it to see if this worked....
demand_A_gph <- curve(demand_A_function, from=0, to=180, xlab = "x", ylab = "y")

#Derive Demand Curve of Sector B

# Use Quantities from 0 to 200 by 5 to Estimate a Demand Curve
vector_demand_B <- seq(0,200,by=5)
# Write function for demand curve for Sector A
demand_B_function <- function(x){(slope_b*(200-x)) + int_b}


# Derive demand curve using the values above
demand_B <- demand_B_function(vector_demand_B)
demand_B

# Graph it to see if this worked....
demand_B_gph <- curve(demand_B_function, from=0, to=200, xlab = "x", ylab = "y")

#Derive Demand Curve of Sector C

# Use Quantities from 0 to 220 by 5 to Estimate a Demand Curve
vector_demand_C <- seq(0,220,by=5)
# Write function for demand curve for Sector A
demand_C_function <- function(x){(slope_c*(220-x)) + int_c}


# Derive demand curve using the values above
demand_C <- demand_C_function(vector_demand_C)
demand_C

# Graph it to see if this worked....
demand_C_gph <- curve(demand_C_function, from=0, to=220, xlab = "x", ylab = "y")

#Derive Demand Curve of Sector D

# Use Quantities from 0 to 300 by 5 to Estimate a Demand Curve
vector_demand_D <- seq(0,300,by=5)
# Write function for demand curve for Sector A
demand_D_function <- function(x){(slope_d*(300-x)) + int_d}


# Derive demand curve using the values above
demand_D <- demand_D_function(vector_demand_D)
demand_D

# Graph it to see if this worked....
demand_D_gph <- curve(demand_D_function, from=0, to=300, xlab = "x", ylab = "y")




#Find all new Demand Curves at Current Level
#Use new points to find new slopes


slope_a_d <- -0.5768419
slope_b_d <- -0.2453285
slope_c_d <- -0.7308526
slope_d_d <- -0.2922217

mccurrent_A #$95.18707 or intercept
mccurrent_B #$49.06656 or intercept
mccurrent_C #$160.7868 or intercept
mccurrent_D #$87.66576 or intercept

```

###Graph all Demand Curves
```{r, message = FALSE, echo = FALSE, warning=FALSE}
demand_plot <- ggplot(data.frame(x = c(0, 350))) + 
  stat_function(fun = demand_A_function, aes(color = "A")) +
  stat_function(fun = demand_B_function, aes(color = "B")) +
  stat_function(fun = demand_C_function, aes(color = "C")) +
  stat_function(fun = demand_D_function, aes(color = "D")) +
  scale_y_continuous(limits= c(-12,170), expand = c(0,0)) +
  scale_x_continuous(limits= c(0, 400), expand = c(0,0)) + 
  labs(fill = "", color = "Sectors") + 
  xlab("\n Carbon Abatement (ton)") + 
  ylab("Marginal Cost \n($/ton) \n") + 
  theme_classic() +
  ggtitle("Demand: Marginal Cost of Abatement\n") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.title.y = element_text(angle=0, hjust = 0.5, vjust = 0.5)) 
demand_plot




```

$$MC_A = -0.5768419(Emissions) + 95.18707$$
$$MC_B = -0.2453285(Emissions) + 49.06656 $$
$$MC_C = -0.7308526Emissions) + 160.7868 $$
$$MC_D = -0.2922217(Emissions)+ 87.66576 $$

###Cutting Carbon Emissions in Half
####Policy Option 1: Cap on Carbon
Suppose to meet the Paris Accord commitments, Country X (which contains sectors A, B, and C) needs to cut all carbon emissions in half. For each policy option derive the following:  
1. The total cost of meeting the target in Country X  
2. The cost (or benefit) to each sector  
3. The tax revenue generated  
####a. Cap on Carbon  
```{r include=FALSE}
# Each sector cuts emissions by 100 - abates 100 
################# Part 1 Write abatement curve functions for each sector and plug in 100 for Q
#### Abatement function Sector A
Abatement_curve_A <- function(x){(slope_a*x) + int_a}
cost_100_A <- Abatement_curve_A(100) 
cost_100_A

#### Abatement function Sector B
Abatement_curve_B <- function(x){(slope_b*x) + int_b}
cost_100_B <- Abatement_curve_B(100)
cost_100_B

#### Abatement function Sector C
Abatement_curve_C <- function(x){(slope_c*x) + int_c}
cost_100_C <- Abatement_curve_C(100)
cost_100_C 


################## Part 2 Integrate to find the area under the curve (the cost of abatement from 0-100)
area_100_A <- integrate(Abatement_curve_A, lower = 0, upper = 100)$value
area_100_A #$2019.762
area_100_B <- integrate(Abatement_curve_B, lower = 0, upper = 100)$value
area_100_B #$1925.491
area_100_C <- integrate(Abatement_curve_C, lower = 0, upper = 100)$value
areac_100_C #$2753.63

################## Part 3 Add all areas together to find the total cost of abating 100 units from each sector
total_cost_abatement_100 <- area_100_A + area_100_B + area_100_C
tca <- round(total_cost_abatement_100, digits =2) #6698.883
tca
```

Marginal cost of abatement curves for each sector are used to calculate the total cost of abating by 100 tons. The area underneath the marginal cost of abatement curve from 0 to 100 gives the total cost of abatement for that sector. The total cost of carbon cap is the sum of the costs of three sectors.

1. Total Cost of Carbon Cap     

$$Total~Cost = 6698.88$$  


2. Cost to each Sector      

$Cost(Sector~A) = `r round(area_100_A, digits=2)`$  $2019.762  

$Cost(Sector~B) = `r round(area_100_B, digits=2)`$  $1925.491 

$Cost(Sector~C) = `r round(area_100_C, digits=2)`$  $2753.63

3. Tax Revenue  

With a cap on carbon, there is no generated tax revenue. 





####Policy Option 2: Tax on Carbon

```{r}
#Find the Demand Curves for Each Sector and Switch in Terms of X to find Aggregate Demand

#For Sector A
A_demand_x_intercept <- (-int_a/slope_a)
A_demand_x_slope <- (1/slope_a)
A_demand_tax <- function(p){A_demand_x_intercept + A_demand_x_slope*p}


#For Sector B
B_demand_x_intercept <- (-int_b/slope_b)
B_demand_x_slope <- (1/slope_b)
B_demand_tax <- function(p){B_demand_x_intercept + B_demand_x_slope*p}


#For Sector C
C_demand_x_intercept <- (-int_c/slope_c)
C_demand_x_slope <- (1/slope_c)
C_demand_tax <- function(p){C_demand_x_intercept + C_demand_x_slope*p}


#Add the Demand Curves Together to Find the Aggregate
Agg_demand_intercept <- sum(A_demand_x_intercept, B_demand_x_intercept, C_demand_x_intercept)
Agg_demand_slope <- sum(A_demand_x_slope, B_demand_x_slope, C_demand_x_slope)


#Switch the Aggregate Demand Curve Back in terms of P (price)
Agg_demand_p_intercept <- (-Agg_demand_intercept/Agg_demand_slope)
Agg_demand_p_slope <- (1/Agg_demand_slope)
Agg_demand_curve_tax <- function(x){Agg_demand_p_intercept + Agg_demand_p_slope*x}


#Find the Optimal Tax by Inputting Desired Level of Emissions (300 Tons)
optimal_tax <- Agg_demand_curve_tax(300)
optimal_tax

#Find the Tax Revenue by Multiplying times the Optimal Emissions
tax_revenue_tax <- optimal_tax*300
tax_revenue_tax


#Find the Cost for Each Sector

#The Cost for Sector A
# Sector A 
quantity_abatement_A <- A_demand_tax(optimal_tax)
quantity_abatement_A # 83.33489
cost_A_tax <- integrate(Abatement_curve_A, lower = 0, upper = quantity_abatement_A)$value + ((180-83.3)*optimal_tax)
cost_A_tax

# Sector B 
quantity_abatement_B <- B_demand_tax(optimal_tax) 
quantity_abatement_B # 151.4956
quantity_abatement_B*optimal_tax
cost_B_tax <- integrate(Abatement_curve_B, lower = 0, upper = quantity_abatement_B)$value + ((200-151.5)*optimal_tax)
cost_B_tax

# Sector C 
quantity_abatement_C <- C_demand_tax(optimal_tax) 
quantity_abatement_C #65.16953
cost_C_tax <- integrate(Abatement_curve_C, lower = 0, upper = quantity_abatement_C)$value + ((220-65.2)*optimal_tax)
cost_C_tax

# Aggregated cost
cost_agg_tax <- sum(cost_A_tax, cost_B_tax, cost_C_tax)
cost_agg_tax
```

The optimal tax is $39.43

The total cost is 17707.79

The cost to Sector A 5095.162

The cost to Sector B 5604.46

The cost to Sector C 7008.164

The tax revenue is $11827.97


Even though they are initially allocated current emissions minus 100, cap and trade will satisfy the equal marginal principle and the total reduction of 300 will be distributed between the three sectors just like in the part b. The marginal cost of abatement will be equal for all sectors which is equal to the marginal cost of abatement of 300th unit on the aggregate cost curve.

1. Total Cost of Carbon Cap and Trade     

The total cost of the cap and trade is the area under the aggregate cost curve from 0 to 300.
```{r include=FALSE}
# Sector A 
#Abates 83.33489 and buys (100-83.33489) from Sector B
cost_A_cap <- integrate(Abatement_curve_A, lower = 0, upper = quantity_abatement_A)$value + ((100-83.33489)*optimal_tax)
cost_A_cap # $1939.66


# Sector B 
 #Abates 151.4956 and sells (200-151.4956) to A and C
cost_B_cap <- integrate(Abatement_curve_B, lower = 0, upper = quantity_abatement_B)$value - ((200-151.4956)*optimal_tax)
cost_B_cap # $1779.909


# Sector C 
# Abates 65.16953 and buys (100-65.16953) from B
cost_C_cap <- integrate(Abatement_curve_C, lower = 0, upper = quantity_abatement_C)$value + ((100-65.16953)*optimal_tax)
cost_C_cap # $2278.176


cost_Agg_cap<- cost_A_cap + cost_B_cap + cost_C_cap
cost_Agg_cap # $5997.744
#costagg_cap <- integrate(agg_abate, lower = 0, upper = 300)$value
```
$Total~Cost~Cap~and~Trade = `r round(costagg_cap, digits=2)`$  

2. Cost/Benefits to each Sector  

Each sector is allocated their current emissions minus 100 tons. The outcome of trading will be the same as if the carbon tax was imposed so the cost of abating is equal to the area under the marginal abatement curve from 0 to the quantity abated. 



$Cost~to~Sector~A = `r round(costa_cap, digits=2)`$      

$Cost~to~Sector~B = `r round(costb_cap, digits=2)`$      

$Cost~to~Sector~C = `r round(costc_cap, digits=2)`$  
   

3. Tax Revenue    

There is no tax revenue with a cap and trade.  






